{:deps
 {org.clojure/clojure #:mvn{:version "1.12.0"},
  org.clojure/tools.cli #:mvn{:version "0.4.1"},
  org.clojure/core.specs.alpha #:mvn{:version "0.2.44"},
  org.clojure/spec.alpha #:mvn{:version "0.2.187"},
  org.clojure/core.async #:mvn{:version "1.3.610"},
  commons-validator/commons-validator #:mvn{:version "1.7"},
  org.babashka/http-client #:mvn{:version "0.4.22"},
  cheshire/cheshire #:mvn{:version "5.13.0"}},
 :paths ["src" "classes" "resources"],
 :aliases
 {:run
  {:main-opts ["-m" "proserunner.core"]}

  ;; Native image build aliases
  ;; Note: These aliases share common configuration but deps.edn doesn't support
  ;; alias composition, so some duplication is necessary for clarity.

  :build
  {:main-opts
   ["-m" "clj.native-image" "proserunner.core"
    "--initialize-at-build-time"
    "-H:Name=proserunner"
    "--report-unsupported-elements-at-runtime"
    "-Dclojure.compiler.direct-linking=true"
    "-H:EnableURLProtocols=http,https"
    "--native-image-info"
    "--enable-http"
    "--enable-https"
    "--no-fallback"
    ;; Performance optimizations
    "-H:+UnlockExperimentalVMOptions"
    "-O3"                              ;; Maximum optimization level
    "-march=x86-64-v2"                 ;; Compatible with most modern CPUs (2009+)
    "--gc=serial"                          ;; Better for larger heaps
    "-R:MaxHeapSize=4g"                ;; Adequate runtime heap
    "--strict-image-heap"
    ;; Build-time memory (faster builds)
    "-J-Xmx8G"
    "-J-XX:+UseParallelGC"
    ],
   :extra-deps
   #:clj.native-image{clj-native-image
                      {:git/url
                       "https://github.com/taylorwood/clj.native-image.git",
                       :sha
                       "4604ae76855e09cdabc0a2ecc5a7de2cc5b775d6"}}},
  :build-macos-arm64
  {:main-opts
   ["-m" "clj.native-image" "proserunner.core"
    "--initialize-at-build-time"
    "-H:Name=proserunner"
    "--report-unsupported-elements-at-runtime"
    "-Dclojure.compiler.direct-linking=true"
    "-H:EnableURLProtocols=http,https"
    "--native-image-info"
    "--enable-http"
    "--enable-https"
    "--no-fallback"
    ;; Performance optimizations for ARM64
    "-H:+UnlockExperimentalVMOptions"
    "-O3"
    "-march=armv8-a"                   ;; ARM64 baseline (Apple Silicon compatible)
    "--gc=serial"
    "-R:MaxHeapSize=4g"
    "--strict-image-heap"
    "-J-Xmx8G"
    "-J-XX:+UseParallelGC"
    ],
   :extra-deps
   #:clj.native-image{clj-native-image
                      {:git/url
                       "https://github.com/taylorwood/clj.native-image.git",
                       :sha
                       "4604ae76855e09cdabc0a2ecc5a7de2cc5b775d6"}}},
  :test
  {:extra-paths ["test"],
   :extra-deps
   {clj-http-fake/clj-http-fake #:mvn{:version "1.0.3"},
    com.cognitect/test-runner
    {:git/url "https://github.com/cognitect-labs/test-runner.git",
     :sha "209b64504cb3bd3b99ecfec7937b358a879f55c1"}},
   :main-opts ["-m" "cognitect.test-runner"]},
  :benchmark
  {:extra-paths ["."]
   :main-opts ["-m" "benchmarks.runner"]},
  :parallel-bench
  {:extra-paths ["."]
   :main-opts ["-m" "benchmarks.parallel"]},
  :scaling-bench
  {:extra-paths ["."]
   :main-opts ["-m" "benchmarks.scaling"]}}}
